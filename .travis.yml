language: ruby
dist: xenial
services: mysql
bundler_args: "--without deployment"
cache:
  bundler: true
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64
  > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- "./cc-test-reporter before-build"
- bundle exec rake db:create
script:
- bundle exec rubocop
- bundle exec rspec
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
before_deploy: "./compile-build"
deploy:
  provider: releases
  api_key:
    secure: WbWKB8iSAdugjqdGr2dSkbamaxR8Gngtsxwc0IekNlL5nJ9riFME2ck2tts8GEcmXWOeMZxrdUGKoIpxsqBhc4kyNKmanYL2zNfw8IXC7rXjwtPsqsS0CnbUByzx611wH8YPRcKWmYGD/LX0cfVX7M/B/tyxHzjrzfVAo38pZi3a/k2OoUI4C/gWVMsiQ/hBaTlWMh7EnxegdE0ROu08DkJTtXJq0vb2/jGP2hZdOsI1lbDwoZoc1bNNd3+urWpCNKTKRgAtyBlSzDdO5LQlGY+6EIATK7YVxHGvvVGpU/uUNlAEd/2PbowkQzsaZKIJ+4Fatv+ANQWsGjirj9FzbbArJxdmoYQ+CYHeEuz/eX5BA272LMfdzaIWQJUBKMRFa49ZE0Dc08GCpAsD60pynM/VPW/vg5bKSX7Bp44TJTz9cw3H+YmSs3206IYY6IIO4BcZG2xyIejSJTU6BDGRmjxd5PVk5nB9RvnVLaIeUs7hqyUlxSsdNKR9otGDMSPUxyN4ZXzmbmCwMJWAFRBrBsHgyVJXAcPZBWv4DdEiIdRwdHkuQEicVYP2ijEHfENRKgoHCa3ikWaez9FsPeqjT516wAvu/GRvVEotV3FN/D3Qf1JGZGJIMoCN7y9iXPfKLhnppz3j8+fW5oev7QRF8fRdGP2AXEkwC3rGIOMQtow=
  file: release.tar.gz
  file_glob: true
  on:
    tags: true
    repo: sanger/event_warehouse
  skip_cleanup: 'true'
